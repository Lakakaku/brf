# =============================================================================
# BRF Portal - Staging Environment Variables
# =============================================================================
# 
# Staging environment for testing production-like configurations with
# non-production data and reduced costs.
#
# =============================================================================

# =============================================================================
# STAGING ENVIRONMENT SETTINGS
# =============================================================================

NODE_ENV=staging
NEXT_PUBLIC_APP_URL=https://staging.brfportal.se
DEBUG=false

# =============================================================================
# DATABASE (Staging PostgreSQL)
# =============================================================================

DATABASE_URL=postgresql://brf_staging:staging_password@staging-db.brfportal.se:5432/brf_portal_staging?sslmode=require
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=20
DATABASE_POOL_TIMEOUT=30
DATABASE_LOG_QUERIES=true
DATABASE_BACKUP_ENABLED=true
DATABASE_BACKUP_SCHEDULE=0 3 * * *
DATABASE_BACKUP_RETENTION_DAYS=30

# =============================================================================
# AUTHENTICATION (Staging with test BankID)
# =============================================================================

NEXTAUTH_URL=https://staging.brfportal.se
NEXTAUTH_SECRET=staging-secret-key-32-characters-for-testing-only

# Moderate security for staging testing
PASSWORD_MIN_LENGTH=8
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBERS=true
PASSWORD_REQUIRE_SYMBOLS=false

# BankID Test Environment (free testing)
BANKID_ENABLED=true
BANKID_ENVIRONMENT=test
BANKID_API_URL=https://appapi2.test.bankid.com/rp/v6.0
BANKID_CLIENT_CERT_PATH=/secure/certs/bankid-test.p12
BANKID_CLIENT_CERT_PASSWORD=test-cert-password
BANKID_CA_CERT_PATH=/secure/certs/bankid-test-ca.crt

# Keep email auth as backup
ENABLE_EMAIL_AUTH=true
ENABLE_TEST_USERS=false

# Minimal mocking in staging
MOCK_BANKID=false
MOCK_EMAIL=false
MOCK_SMS=true  # Keep SMS mocked to avoid costs
MOCK_PAYMENT=true  # Keep payments mocked for safety
MOCK_EXTERNAL_APIS=false

# =============================================================================
# EXTERNAL APIS (Staging with limited usage)
# =============================================================================

# OpenAI with lower quotas for staging
OPENAI_API_KEY=sk-staging-api-key-here
OPENAI_MODEL=gpt-4
OPENAI_MAX_TOKENS=2000  # Lower for cost control
OPENAI_TEMPERATURE=0.1

# =============================================================================
# SWEDISH INTEGRATIONS (Test environments where available)
# =============================================================================

# Fortnox Test API
FORTNOX_API_URL=https://api.fortnox.se/3
FORTNOX_CLIENT_SECRET=staging-fortnox-secret
FORTNOX_ACCESS_TOKEN=staging-fortnox-token

# Visma Test
VISMA_API_URL=https://eaccountingapi-sandbox.vismaonline.com/v2
VISMA_CLIENT_ID=staging-visma-client
VISMA_CLIENT_SECRET=staging-visma-secret
VISMA_REDIRECT_URI=https://staging.brfportal.se/api/auth/visma/callback

# Kivra Staging (if available)
KIVRA_API_URL=https://api-staging.kivra.com/v1
KIVRA_API_KEY=staging-kivra-key
KIVRA_SENDER_ID=staging-sender

# =============================================================================
# FILE STORAGE (Staging S3)
# =============================================================================

AWS_REGION=eu-north-1
AWS_ACCESS_KEY_ID=staging-access-key
AWS_SECRET_ACCESS_KEY=staging-secret-key
AWS_S3_BUCKET=brf-portal-documents-staging
AWS_S3_BUCKET_REGION=eu-north-1

MAX_FILE_SIZE=50MB
MAX_TOTAL_SIZE=500MB
DOCUMENT_PROCESSING_TIMEOUT=300

# =============================================================================
# EMAIL SERVICES (Staging)
# =============================================================================

# Use staging email service
SENDGRID_API_KEY=staging-sendgrid-key
FROM_EMAIL=staging@brfportal.se
FROM_NAME=BRF Portal Staging
REPLY_TO_EMAIL=staging-support@brfportal.se
EMAIL_BASE_URL=https://staging.brfportal.se

# =============================================================================
# CACHING (Staging Redis)
# =============================================================================

REDIS_URL=redis://staging-redis.brfportal.se:6379
REDIS_PASSWORD=staging-redis-password
CACHE_TTL_DEFAULT=1800  # 30 minutes
RATE_LIMIT_MAX=500

# =============================================================================
# MONITORING (Staging)
# =============================================================================

SENTRY_DSN=https://staging-sentry-dsn@sentry.io/staging-project
SENTRY_ENVIRONMENT=staging
SENTRY_TRACE_SAMPLE_RATE=0.1

LOG_LEVEL=debug
LOG_FORMAT=json
PERFORMANCE_MONITORING_ENABLED=true

# =============================================================================
# FEATURE FLAGS (Staging - Test all features)
# =============================================================================

FEATURE_BANKID_AUTH=true
FEATURE_AI_PROCESSING=true
FEATURE_PAYMENT_PROCESSING=false  # Keep false for safety
FEATURE_EMAIL_NOTIFICATIONS=true
FEATURE_SMS_NOTIFICATIONS=false
FEATURE_ENERGY_OPTIMIZATION=true
FEATURE_ADVANCED_ANALYTICS=true
FEATURE_API_ACCESS=true

# =============================================================================
# SECURITY (Staging)
# =============================================================================

ENCRYPTION_KEY=staging-encryption-key-32-chars
JWT_SIGNING_KEY=staging-jwt-key-32-characters
CSRF_SECRET=staging-csrf-secret
CSP_ENABLED=true
CORS_ORIGIN=https://staging.brfportal.se

# =============================================================================
# API QUOTAS (Staging - Limited)
# =============================================================================

API_RATE_LIMIT_PER_HOUR=5000
API_RATE_LIMIT_PER_DAY=50000

OPENAI_MONTHLY_QUOTA=100000   # 100k tokens
BANKID_MONTHLY_QUOTA=1000     # 1k test authentications
SMS_MONTHLY_QUOTA=100         # 100 test messages

# =============================================================================
# DEPLOYMENT (Staging)
# =============================================================================

DEPLOYMENT_ENV=staging
DEPLOYMENT_REGION=eu-north-1
HEALTH_CHECK_ENABLED=true
AUTO_SCALE_MIN_INSTANCES=1
AUTO_SCALE_MAX_INSTANCES=5

BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 4 * * *
BACKUP_RETENTION_DAYS=7  # Short retention for staging

# =============================================================================
# MULTI-TENANT (Staging)
# =============================================================================

MULTI_TENANT_MODE=true
ENABLE_SUBDOMAIN_ROUTING=true
BASE_DOMAIN=staging.brfportal.se
WILDCARD_DOMAIN=*.staging.brfportal.se
MAX_TENANTS_PER_INSTANCE=50

# =============================================================================
# NOTES FOR STAGING ENVIRONMENT
# =============================================================================
#
# 1. Use staging/test APIs where available
# 2. Keep costs low with reduced quotas
# 3. Test all production features safely
# 4. Use production-like infrastructure
# 5. Keep payments and SMS mocked for safety
# 6. Regular testing of deployment processes
# 7. Data can be reset/refreshed regularly
#
# =============================================================================